# Everything good!
# 20251121

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>EzBot</title>
  <link rel="icon" type="image/png" href="/static/favicon.png">
  <style>
    /* --- Global layout --- */
    body {
      font-family: "Poppins", system-ui, sans-serif;
      margin: 0;
      padding: 0;
      height: 100vh;
      width: 100vw;
      background: #ffffff;
      display: flex;
      flex-direction: column;
    }

    /* --- Header (full width) --- */
    #chat-header {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 16px 24px;
      width: 100%;
      background: #ffffff;
      /*border-bottom: 1px solid #eaeaea;*/
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
      position: fixed;
      top: 0;
      left: 0;
      z-index: 10;
    }

    #chat-logo {
      width: 32px;
      height: auto;
      margin-right: 0px;
      position: relative;
      top: -1px;             /* nudges it upward to align perfectly with text baseline */
      filter: drop-shadow(0 2px 6px rgba(0, 0, 0, 0.3));
    }

    #chat-title {
      font-size: 1.2rem;
      font-weight: 600;
      color: #2d3748;
      /*position: relative;*/
      /*top: 2px;*/
    }

    #chat-title strong {
      color: #007bff;
    }

    /* --- Centered main chat section --- */
    #chat-main {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding-top: 100px; /* space for fixed header */
      padding-bottom: 100px; /* space for input area */
      overflow-y: auto;
    }

    /* Chat area (messages) */
    #chatbox {
      width: 50%;
      display: flex;
      flex-direction: column;
      align-items: stretch;
      overflow-y: auto;
    }

    /* Base message styling */
    .message {
      margin-bottom: 16px;
      line-height: 1.55;
      word-wrap: break-word;
      white-space: pre-wrap;
      max-width: 100%;
      font-size: 1rem;
      font-family: "Poppins", system-ui, sans-serif;
    }

    /* User messages ‚Äî slightly narrower and right aligned */
    .message.user {
      align-self: flex-end;
      background: #d1e7ff;
      color: #1a1a1a;
      border-radius: 16px;
      border-bottom-right-radius: 4px;
      padding: 10px 18px;
      width: 70%; /* ‚úÖ 70% of the 50% chat width (0.7 √ó 50% ‚âà 35%) */
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
    }

    /* Bot messages ‚Äî plain text, no bubble box */
    .message.bot {
      align-self: flex-start;
      color: #1a1a1a;
      background: transparent; /* ‚úÖ no box or color */
      border: none;
      padding: 0;
      width: 100%; /* match main chat width for text flow */
    }

    /* --- Input area (centered, same width as chat) --- */
    #input-area {
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100%;                  /* ‚úÖ spans full width for subtle bar */
      background: #ffffff;
      box-shadow: 0 -6px 20px rgba(0, 0, 0, 0.01);
      display: flex;
      justify-content: center;      /* centers inner input box */
      padding: 14px 0;              /* balanced vertical spacing */
      z-index: 10;
    }

    /* Inner wrapper (input + button) centered within chat width */
    #input-wrapper {
      width: 50%;                   /* ‚úÖ match chat width */
      display: flex;
      align-items: center;
      gap: 10px;
    }

    /* Input and button styling */
    #message-input {
      flex: 1;
      padding: 14px 18px;
      font-size: 1rem;
      border: 1px solid #ddd;
      border-radius: 24px;
      outline: none;
      background: #f7f7f8;
    }

    #message-input:focus {
      background: #ffffff;
      border: 1px solid #999; /* neutral, visible gray border */
      outline: none;
      box-shadow: none;
    }

    #send-btn {
      padding: 12px 22px;
      font-size: 1rem;
      border: none;
      border-radius: 24px;
      background: #007bff;
      color: white;
      cursor: pointer;
      transition: background 0.3s ease;
    }

    #send-btn:hover {
      background: #005fcc;
    }

    

    /* --- Mobile layout --- */
    @media (max-width: 768px) {

      #legal-bottom {
        font-size: 1.5rem !important;
      }

      #legal-bottom a {
        font-size: 1.5rem !important;
      }

      #brand-top { font-size: 1.7rem; }
      
      /* 1Ô∏è‚É£ ÁôªÂΩïÊèêÁ§∫ÊñáÂ≠ó */
      #login-screen h2 {
        font-size: 1.4rem;
        line-height: 1.4;
      }

      /* 2Ô∏è‚É£ Â∫ïÈÉ® warning ÊñáÊú¨ */
      #login-footer-warning {
        font-size: 1.05rem;
      }

      #login-footer-warning p {
        font-size: 1.05rem;
        line-height: 1.45;
      }

      /* ËÅäÂ§©Âå∫ÂüüÂÆΩÂ∫¶Âç†Êª°ÊâãÊú∫Â±èÂπï */
      .message {
        width: 90% !important;    /* ‰∏çË¶ÅÂõ∫ÂÆö 50% */
        font-size: 1rem;          /* ËÆ©Â≠óÂ§ß‰∏ÄÁÇπ */
      }

      #message-input {
        width: 90% !important;    /* ËæìÂÖ•Ê°ÜÊíëÂºÄÁ©∫Èó¥ */
        font-size: 1rem;
      }

      #chatbox {
        padding: 100px 10px 120px 10px; /* Êõ¥Á¥ßÂáë */
      }

      #chat-container {
        width: 100vw !important;
        height: 100vh !important;
        margin: 0;
        border-radius: 0;
      }

      #chat-header {
        padding: 10px 14px;
      }

      #chat-title {
        font-size: 1.1rem;
      }

      #chat-logo {
        width: 45px;
        height: 45px;
      }
    }

    /* Typing dots */
    .typing {
      display: inline-block;
      width: 1em;
      height: 1em;
      border-radius: 50%;
      background-color: #888;
      margin-right: 3px;
      animation: blink 1.2s infinite ease-in-out both;
    }
    .typing:nth-child(2) { animation-delay: 0.2s; }
    .typing:nth-child(3) { animation-delay: 0.4s; }
    @keyframes blink {
      0%, 80%, 100% { opacity: 0.2; }
      40% { opacity: 1; }
    }

    @keyframes blink {
      0%, 80%, 100% { opacity: 0.2; }
      40% { opacity: 1; }
    }

    #input-area {
      display: flex;
      border-top: 1px solid #ddd;
    }

    #message-input {
      flex: 1;
      padding: 12px;
      border: none;
      outline: none;
      font-size: 1em;
    }

    button {
      padding: 12px 16px;
      border: none;
      background: #007bff;
      color: white;
      font-size: 1em;
      cursor: pointer;
    }

    button:hover {
      background: #0056b3;
    }

    #login-screen {
      position: fixed;
      inset: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;

      /* Background image */
      background-image: url("/static/background2.jpg"); /* or your own image URL */
      background-size: cover;        /* fills entire screen */
      background-position: center;   /* centers image */
      background-repeat: no-repeat;
      background-attachment: fixed;  /* subtle parallax effect */

      /* Dark overlay for contrast */
      background-color: rgba(0, 0, 0, 0.25);
      background-blend-mode: darken;

      /* Subtle blur for modern look */
      backdrop-filter: blur(6px);
      -webkit-backdrop-filter: blur(6px);
    }

    /* üëá Add your brand + tagline styles here */
    #brand {
      font-size: 3rem;
      font-weight: 700;
      color: white;
      text-shadow: 0 2px 8px rgba(0,0,0,0.4);
      margin-bottom: 0.3em;
    }

    #tagline {
      font-size: 1.3rem;
      font-weight: 700;
      background: linear-gradient(
        90deg,
        #000 33%,
        #dd0000 33%,
        #dd0000 66%,
        #ffce00 66%
      );
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      text-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
      letter-spacing: 1px;
      margin-bottom: 1.5em;
    }

    #logo {
      width: 100px;
      height: auto;
      margin-bottom: 1rem;
      filter: drop-shadow(0 2px 6px rgba(0,0,0,0.4));
    }

    #login-screen h2,
    #login-screen input,
    #login-screen button {
      color: white;
      z-index: 1;
    }

    /* Input styling for readability */
    #login-screen input {
      background: rgba(255, 255, 255, 0.2);
      color: white;
      border: 1px solid rgba(255,255,255,0.4);
      border-radius: 6px;
    }

    #login-screen input::placeholder {
      color: rgba(255,255,255,0.8);
    }

    #login-screen button {
      background: rgba(255, 255, 255, 0.3);
      border: 1px solid rgba(255,255,255,0.5);
      transition: background 0.3s ease;
    }

    #login-screen button:hover {
      background: rgba(255,255,255,0.5);
    }
    


  /* Smooth fade-in animation for bot messages */
  .message.bot {
    animation: fadeIn 0.3s ease-in;
  }

  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(3px); }
    to { opacity: 1; transform: translateY(0); }
  }


  /* Normalize Markdown spacing INSIDE bubbles */
  .message p,
  .message ul,
  .message ol,
  .message pre,
  .message code,
  .message blockquote {
    margin: 0;              /* kill default outside margins */
  }

  /* Restore gentle vertical rhythm */
  .message p + p,
  .message p + ul,
  .message p + ol,
  .message ul + p,
  .message ol + p,
  .message pre + p,
  .message p + pre,
  .message blockquote + p {
    margin-top: 0.5em;      /* controlled spacing between blocks */
  }

  /* Make first/last child not add extra space at bubble edges */
  .message > :first-child { margin-top: 0 !important; }
  .message > :last-child  { margin-bottom: 0 !important; }

  /* Lists look tidy but don‚Äôt push bubble edges */
  .message ul, .message ol {
    padding-left: 1.2em;    /* list indent */
  }

  /* Code blocks look neat but don‚Äôt bloat bottom */
  .message pre {
    padding: 8px;
    border-radius: 8px;
    background: #f5f5f5;
    overflow-x: auto;
  }

  /* Inline code */
  .message code {
    background: #f5f5f5;
    padding: 2px 4px;
    border-radius: 4px;
  }

  /* Keep your bubble‚Äôs own vertical padding modest & symmetric */
  .message {
    padding: 10px 18px;     /* equal top/bottom */
    line-height: 1.5;
  }

  /* Optical vertical centering fix for chat bubbles */
  .message {
    position: relative;
  }

  .message.user::before {
    content: "";
    display: block;
    height: 0;
    margin-top: -0.3em;
  }
  

  /* --- Compact spacing between section titles and bullet lists inside chat messages --- */
  /* Reduce space below titles when followed by a list */
  .message h1 + ul,
  .message h2 + ul,
  .message h3 + ul,
  .message h4 + ul,
  .message h5 + ul,
  .message h6 + ul,
  .message h1 + ol,
  .message h2 + ol,
  .message h3 + ol,
  .message h4 + ol,
  .message h5 + ol,
  .message h6 + ol {
    margin-top: 0.01em;  /* ‚úÖ tighten gap between header and list */
  }

  /* Reduce top and bottom margins for all headings inside messages */
  .message h1,
  .message h2,
  .message h3,
  .message h4,
  .message h5,
  .message h6 {
    margin-top: 0.1em;   /* less top space */
    margin-bottom: 0.05em; /* less bottom space */
    line-height: 1.3;
  }

  /* Reduce spacing between list items */
  .message ul,
  .message ol {
    margin-top: 0.05em;   /* tighten above list */
    margin-bottom: 0.1em;
    padding-left: 1.2em;
  }

  /* --- Reduce spacing between numbered and bulleted lists inside chat messages --- */

  /* Remove big gap when one list follows another */
  .message ol + ul,
  .message ul + ol {
    margin-top: 0.01em;   /* ‚úÖ reduce vertical gap between consecutive lists */
  }

  /* Keep consistent spacing between any lists and other elements */
  .message p + ul,
  .message p + ol,
  .message ul + p,
  .message ol + p {
    margin-top: 0.1em;
  }

  /* General list tightening (keeps everything neat) */
  .message ul,
  .message ol {
    margin-top: 0.03em;
    margin-bottom: 0.05em;
    padding-left: 1.2em;
  }

  .message li {
    margin-bottom: 0.01em;
    line-height: 1.5;
  }

  /* formatting of the copy button */
  .copy-btn {
    background: transparent;
    border: none;
    color: #007bff;
    font-size: 0.9rem;
    cursor: pointer;
    margin-top: 6px;
    float: right;                 /* ‚úÖ right-align the button */
    transition: color 0.2s ease, opacity 0.2s ease;
    opacity: 0.6;
  }

  .copy-btn:hover {
    color: #0056b3;
    opacity: 1;
    text-decoration: underline;
  }

  /* Optional: fade in on hover (like ChatGPT) */
  .message.bot:hover .copy-btn {
    opacity: 1;
  }

  /* the button is closer to the reply text*/
  .message.bot {
    padding-bottom: 1px;
  }

  /* üîπ Legal links on the login page (top-right) */
  #legal-links {
    position: absolute;
    top: 15px;
    right: 20px;
    z-index: 999;
    font-size: 0.95rem;
  }

  #legal-links a {
    color: white;
    text-decoration: none !important;
    margin: 0 6px;
    font-weight: 500;
  }

  #legal-links span {
    color: white;
  }

  #legal-links a:hover {
    color: #f0f0f0;
    text-decoration: none !important;
  }

  #login-footer-warning {
    position: absolute;
    bottom: 50px;
    text-align: center;
    width: 100%;
    color: rgba(255, 255, 255, 0.85);
    font-size: 0.9rem;
    line-height: 1.4;
    padding: 0 20px;
  }

  #login-footer-warning p {
    margin: 3px 0;
    text-shadow: 0 1px 3px rgba(0,0,0,0.4);
  }

  /* Horizontal brand line (top-left aligned) */
  #brand-row {
    position: absolute;
    top: 80px;              /* Ë∞ÉÊï¥‰∏é‰Ω†ÁöÑ legal links ‰ΩçÁΩÆ‰øùÊåÅÁæéËßÇ */
    left: 20px;
    display: flex;
    align-items: center;
    gap: 12px;
    color: white;
    font-size: 1.3rem;
    font-weight: 600;
    width: calc(100% - 40px);
  }

  /* Main brand text */
  .brand-main {
    white-space: nowrap;     /* Èò≤Ê≠¢Êç¢Ë°å */
  }

  /* Sub text inside brand */
  .brand-sub {
    font-weight: 400;
    opacity: 0.9;
  }

  /* ËæìÂÖ•Ê°Ü placeholder */
  #passcode-input::placeholder {
    color: rgba(255,255,255,0.8);
  }

  #brand-top {
    position: absolute;
    top: 20px;              /* Ë¥¥ËøëÈ°∂ÈÉ® */
    left: 20px;             /* ‰ªéÂ∑¶ËæπÂºÄÂßã */
    display: flex;
    align-items: center;
    gap: 12px;

    color: white;
    font-size: 1.8rem;      /* Â≠óÊõ¥Â§ß */
    font-weight: 600;
    white-space: nowrap;
  }

  #legal-bottom {
    position: absolute;
    bottom: 20px;           /* ‰Ωç‰∫éÂ∫ïÈÉ® */
    width: 100%;
    text-align: center;
    color: white;
    font-size: 1.2rem;
  }

  #legal-bottom a {
    color: white;
    text-decoration: none;  /* ÂéªÊéâ‰∏ãÂàíÁ∫ø */
    font-size: 1.2rem;
    font-weight: 500;
  }

  #legal-bottom span {
    margin: 0 6px;
  }

  #passcode-input {
    height: 40px;
    padding: 0 10px;
    font-size: 1rem;
    border-radius: 6px;
    border: 1px solid #ccc;
  }

  /* Á°Æ‰øùËæìÂÖ•Ê°ÜÂíåÊåâÈíÆÂú®Âêå‰∏ÄË°åÔºåÂûÇÁõ¥Â±Ö‰∏≠ */
  #passcode-row {
    display: flex;
    justify-content: center;
    align-items: center;      /* ÂûÇÁõ¥ÂØπÈΩêÂÖ≥ÈîÆ */
    gap: 10px;
    margin-top: 12px;
  }

  /* Clean input + button for login (NO margin) */
  #login-screen input,
  #login-screen button {
    margin: 0;              /* remove harmful margin */
    box-sizing: border-box;
  }

  /* Input specific */
  #passcode-input {
    height: 42px;
    padding: 0 14px;
    border-radius: 6px;
    border: 1px solid rgba(255,255,255,0.5);
    background: rgba(255,255,255,0.2);
    color: white;
  }

  /* Button specific */
  #passcode-btn {
    height: 42px;
    padding: 0 18px;
    background: #007bff;
    color: white;
    border-radius: 6px;
    border: none;
  }

  /* Áªü‰∏ÄÈ´òÂ∫¶„ÄÅÂÜÖÂ§ñËæπË∑ù„ÄÅÁõíÊ®°Âûã */
  #passcode-input,
  #passcode-btn {
    height: 42px;             /* ÂÆåÂÖ®‰∏ÄÊ†∑È´ò */
    padding: 0 14px;          /* ÂÉèÁ¥†Á∫ßÂà´ÊéßÂà∂ÂÜÖËæπË∑ù */
    font-size: 1rem;
    border-radius: 6px;
    box-sizing: border-box;
    margin: 0;                /* Ë¶ÜÁõñ‰πãÂâçÁöÑ margin-bottom */
  }

  /* ‰∏ìÈó®ÁªôËæìÂÖ•Ê°ÜÁöÑÊ†∑ÂºèÔºàÂèØÊåâ‰Ω†ÂéüÊù•È£éÊ†ºÊù•Ôºâ */
  #passcode-input {
    border: 1px solid rgba(255,255,255,0.5);
    background: rgba(255,255,255,0.2);
    color: white;
    width: 200px;
  }

  /* placeholder È¢úËâ≤ */
  #passcode-input::placeholder {
    color: rgba(255,255,255,0.8);
  }

  /* ÊåâÈíÆÊ†∑Âºè */
  #passcode-btn {
    border: none;
    background: #007bff;
    color: white;
    cursor: pointer;
    display: inline-flex;      /* ËÆ©ÊñáÂ≠óÂú®ÊåâÈíÆÈáå‰πüÂûÇÁõ¥Â±Ö‰∏≠ */
    align-items: center;
    justify-content: center;
  }

  #passcode-btn:hover {
    background: #005fcc;
  }


  /* Âº∫Âà∂ËÆ© Enter ÊåâÈíÆ‰øùÊåÅËìùËâ≤ËÉåÊôØ */
  #passcode-btn {
    background: #007bff !important;
    border: none;
    color: white;
  }


  /* 1) È°∂ÈÉ®Â∑¶‰∏äËßíÊ†áÈ¢òÔºöEzBot | ... Êõ¥Â§ß */
  #brand-top {
    font-size: 2.4rem;   /* ‰Ω†ÂèØ‰ª•ÊîπÊàê 2.2 / 2.6 ÁúãÊïàÊûú */
    font-weight: 700;
  }

  /* 2) ÁôªÂΩïÊèêÁ§∫ÔºöPlease enter your passcode... Êõ¥Â§ß */
  #login-screen h2 {
    font-size: 1.6rem;
    font-weight: 600;
    margin: 16px 0 12px 0; /* ÂèØÈÄâÔºöÊõ¥ËàíÊúçÁöÑÈó¥Ë∑ù */
  }

  /* 3) Â∫ïÈÉ® warning ‰∏§Ë°åÊõ¥Â§ß */
  #login-footer-warning {
    font-size: 1.1rem;
  }

  #login-footer-warning p {
    font-size: 1.1rem;  /* Á°Æ‰øù p ‰∏çË¢´Âà´ÁöÑÊ†∑ÂºèÂéãÂõûÂéª */
  }


  /* ===== Sample Questions ===== */
  #sample-questions {
    width: 50%;
    margin: 10px auto 18px auto;
    padding: 14px 16px;
    border-radius: 12px;
    background: #f7f7f8;
    color: #1a1a1a;
  }

  #sample-questions .sq-title h2 {
    margin: 0 0 6px 0;
    font-size: 1.25rem;
  }

  #sample-questions .sq-title p {
    margin: 0 0 10px 0;
    font-size: 0.98rem;
    opacity: 0.9;
  }

  #sq-container {
    display: flex;
    flex-direction: column;
    gap: 10px;
  }

  .sq-block {
    padding: 10px 12px;
    border-radius: 10px;
    background: white;
    border: 1px solid #e9e9ee;
  }

  .sq-block .sq-category {
    font-weight: 700;
    margin: 0 0 8px 0;
    font-size: 1rem;
  }

  .sq-item {
    display: flex;
    gap: 8px;
    align-items: center;
    justify-content: space-between;
    padding: 6px 0;
  }

  .sq-text {
    flex: 1;
    font-size: 0.98rem;
    line-height: 1.35;
    padding-right: 10px;
  }

  .sq-copy {
    border: 1px solid #d6d6de;
    background: #ffffff;
    border-radius: 10px;
    padding: 6px 10px;
    cursor: pointer;
    font-size: 0.9rem;
  }

  .sq-copy:hover {
    background: #f1f1f4;
  }

  /* Mobile: make it full-width */
  @media (max-width: 768px) {
    #sample-questions { width: 92% !important; }
    #sample-questions .sq-title h2 { font-size: 1.15rem; }
    .sq-text { font-size: 1rem; }
  }


  /* ===== Welcome Banner ===== */
  #welcome-banner {
    width: 50%;
    margin: 20px auto 10px auto;
    text-align: center;
  }

  #welcome-banner h1 {
    margin: 0;
    font-size: 1.8rem;
    font-weight: 700;
    color: #007bff;
  }

  #welcome-banner p {
    margin-top: 10px;
    font-size: 1.1rem;
    line-height: 1.6;
    color: #2d3748;
  }

  /* Mobile */
  @media (max-width: 768px) {
    #welcome-banner {
      width: 92%;
    }

    #welcome-banner h1 {
      font-size: 1.6rem;
    }

    #welcome-banner p {
      font-size: 1.05rem;
    }
  }


  /* =========================
   Tighter spacing for BOT Markdown output
   ========================= */

  /* Âè™ÂΩ±Âìç bot ÂÜÖÂÆπÔºåÈÅøÂÖçÂΩ±ÂìçÁî®Êà∑Ê∞îÊ≥° */
  .message.bot .message-text,
  .message.bot {
    line-height: 1.5;
  }

  /* Áªü‰∏ÄÂéãÊéâÈªòËÆ§ marginÔºàËøô‰∫õÊòØÈÄ†ÊàêÂ§ßÁ©∫ÁôΩÁöÑ‰∏ªÂõ†Ôºâ */
  .message.bot p,
  .message.bot h1, .message.bot h2, .message.bot h3, .message.bot h4, .message.bot h5, .message.bot h6,
  .message.bot ul, .message.bot ol,
  .message.bot li,
  .message.bot blockquote,
  .message.bot pre {
    margin: 0;
  }

  /* ÊéßÂà∂Âùó‰∏éÂùó‰πãÈó¥ÁöÑÈó¥Ë∑ùÔºàÂÖ≥ÈîÆÔºâ */
  .message.bot p + p,
  .message.bot p + ul,
  .message.bot p + ol,
  .message.bot ul + p,
  .message.bot ol + p,
  .message.bot h1 + p, .message.bot h2 + p, .message.bot h3 + p,
  .message.bot h4 + p, .message.bot h5 + p, .message.bot h6 + p,
  .message.bot h1 + ul, .message.bot h2 + ul, .message.bot h3 + ul,
  .message.bot h4 + ul, .message.bot h5 + ul, .message.bot h6 + ul,
  .message.bot h1 + ol, .message.bot h2 + ol, .message.bot h3 + ol,
  .message.bot h4 + ol, .message.bot h5 + ol, .message.bot h6 + ol,
  .message.bot ul + ul,
  .message.bot ol + ol,
  .message.bot ol + ul,
  .message.bot ul + ol,
  .message.bot blockquote + p,
  .message.bot p + blockquote,
  .message.bot pre + p,
  .message.bot p + pre {
    margin-top: 0.45em;   /* ‚úÖ ‰Ω†ÂèØ‰ª•ÊîπÊàê 0.35em Êõ¥Á¥ßÂáë */
  }

  /* Ê†áÈ¢òÊú¨Ë∫´ÁöÑ‰∏ä‰∏ãÁïôÁôΩÊõ¥Â∞è */
  .message.bot h1, .message.bot h2, .message.bot h3 {
    line-height: 1.25;
    margin-top: 0.6em;
  }
  .message.bot h4, .message.bot h5, .message.bot h6 {
    line-height: 1.25;
    margin-top: 0.5em;
  }

  /* ÂàóË°®Áº©Á¥ßÔºöli ÁöÑÈó¥Ë∑ùÊõ¥Â∞è */
  .message.bot ul, .message.bot ol {
    padding-left: 1.25em;
  }
  .message.bot li + li {
    margin-top: 0.2em;
  }

  /* Èò≤Ê≠¢‚ÄúÁ©∫ÊÆµËêΩ‚ÄùÈÄ†ÊàêÂ§ßÁ©∫ÁôΩÔºàÂæàÂ§öÊ®°Âûã‰ºöËæìÂá∫Á©∫Ë°å -> <p>&nbsp;</p>Ôºâ */
  .message.bot p:empty {
    display: none;
  }

  /* Â¶ÇÊûú marked ‰∫ßÁîü‰∫Ü <br> Â§öÊ¨°Êç¢Ë°åÂØºËá¥Á©∫ÁôΩÔºå‰πüËÆ©ÂÆÉÊ≤°ÈÇ£‰πàÂ§∏Âº† */
  .message.bot br {
    line-height: 0.9;
  }

  </style>
</head>
<body>

  <div id="login-screen">

    <!-- üîπ Top-right legal links (login page only) -->
    <div id="legal-bottom">
      <a href="/imprint.html" target="_blank">Imprint</a>
      <span>|</span>
      <a href="/disclaimer.html" target="_blank">Disclaimer</a>
      <span>|</span>
      <a href="/privacy.html" target="_blank">Privacy Policy</a>
    </div>

    <div id="brand-top">
        <span>EzBot | A Research Chatbot Made by Scholars in Berlin</span>
    </div>

    <h2>Please enter your passcode to start a chat!</h2>
    <div id="passcode-row">
      <input id="passcode-input" placeholder="Passcode" />
      <button id="passcode-btn" onclick="login()">Enter</button>
    </div>

    <div id="login-footer-warning">
      <p>‚ö†Ô∏è Responses from chatbots may contain errors. Please be cautious.</p>
      <p>üîí To protect privacy, please do not share your personal data such as name and phone number.</p>
    </div>
  </div>

  <div id="chat-container" style="display:none;">

    <!-- Header: full width -->
    <header id="chat-header">
      <img id="chat-logo" src="/static/logo2.png" alt="EzBot logo" />
      <span id="chat-title"><strong>EzBot</strong> | AI Assistant Truly for You</span>
    </header>




    <!-- Centered chat section -->
    <div id="chat-main">

            <!-- üîµ Welcome Message (separate, more prominent) -->
      <div id="welcome-banner" style="display:none;">
        <h1>Welcome to EzBot!</h1>
        <p>
          I am a helpful digital assistant capable of answering questions in many domains.
          Below are some example questions you might ask me. You can also ask whatever questions you have in mind. Happy chatting! üòâ
        </p>
      </div>

      <!-- üü¢ Sample Questions -->
      <div id="sample-questions" style="display:none;">
        <div id="sq-container"></div>
      </div>

      <div id="chatbox"></div>

      <div id="input-area">
        <div id="input-wrapper">
          <input id="message-input" placeholder="Type your message..." />
          <button id="send-btn" onclick="sendMessage()">Send</button>
        </div>
      </div>
    </div>

  </div>



  <script>
    const apiBase = "http://127.0.0.1:8000";
    const passcodeKey = "chat_passcode";
    const historyKey = "chat_history";
    let historyOffset = 0;
    const historyLimit = 20;
    let totalMessages = 0;
    let loadingHistory = false;

    // ‚úÖ Auto-login if a 14-character passcode is in the link
    window.onload = async function() {
      const query = window.location.search; // e.g. "?ABCDEFG1234567"
      const potentialCode = query.startsWith("?") ? query.substring(1) : "";

      if (potentialCode && potentialCode.length === 14) {
        console.log("Detected passcode from URL:", potentialCode);

        // Save the passcode in session
        sessionStorage.setItem(passcodeKey, potentialCode);

        // Attempt to record this passcode in the database (if new)
        try {
          await fetch("/add_passcode?passcode=" + potentialCode, { method: "POST" });
        } catch (err) {
          console.warn("Could not record passcode:", err);
        }

        // Show chat directly
        document.getElementById("login-screen").style.display = "none";
        document.getElementById("chat-container").style.display = "flex";

        // Load chat history (if any)
        fetchHistoryFromBackend(potentialCode);

        // ‚úÖ Optional: remove code from URL bar for privacy
        window.history.replaceState({}, document.title, "/");
      } else {
        // No valid code in URL ‚Üí normal behavior
        const savedPasscode = sessionStorage.getItem(passcodeKey);
        if (savedPasscode) {
          document.getElementById("login-screen").style.display = "none";
          document.getElementById("chat-container").style.display = "flex";
          fetchHistoryFromBackend(savedPasscode);
        } else {
          document.getElementById("login-screen").style.display = "flex";
        }
      }
    };

    async function login() {
      const passcode = document.getElementById("passcode-input").value.trim();
      if (!passcode) {
        alert("Please enter your passcode");
        return;
      }

      // ‚úÖ ËøôÈáå‰∏çÂÜçËá™Âä® /add_passcodeÔºåËÄåÊòØÂÖàË∞ÉÁî® /auth ÂÅöÊ†°È™å
      const res = await fetch("/auth", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ passcode })
      });

      if (!res.ok) {
        const err = await res.json().catch(() => ({}));
        alert(err.detail || "Invalid passcode. Try again.");
        return;
      }

      // ‚úÖ Âè™ÊúâÈÄöËøá /auth Ê†°È™åÊâçËÆ§‰∏∫ÁôªÂΩïÊàêÂäü
      sessionStorage.setItem(passcodeKey, passcode);
      sessionStorage.removeItem(historyKey);

      document.getElementById("login-screen").style.display = "none";
      document.getElementById("chat-container").style.display = "flex";

      fetchHistoryFromBackend(passcode);
    }

    async function sendMessage() {
      const passcode = sessionStorage.getItem(passcodeKey);
      if (!passcode) {
        alert("Session expired. Please re-enter your passcode.");
        location.reload();
        return;
      }

      const input = document.getElementById("message-input");
      const msg = input.value.trim();
      if (!msg) return;

      addMessage(msg, "user");
      input.value = "";

      const indicator = showTypingIndicator();

      try {
        const res = await fetch("/chat", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ passcode, message: msg })
        });

        if (!res.ok) throw new Error(`HTTP ${res.status}`);

        const data = await res.json();
        indicator.remove();

        if (data && data.reply) {
          typeBotMessage(data.reply || data.response);
        } else {
          console.error("Unexpected response:", data);
          addMessage("‚ö†Ô∏è Unexpected response from server.", "bot");
        }
      } catch (err) {
        indicator.remove();
        console.error("Fetch error:", err);
        addMessage("‚ö†Ô∏è Network error. Please try again.", "bot");
      }
    }

    function addMessage(text, sender) {
      const chatbox = document.getElementById("chatbox");

      const messageDiv = document.createElement("div");
      messageDiv.classList.add("message", sender);

      const formatted = marked.parse(text);
      const messageText = document.createElement("div");
      messageText.classList.add("message-text");
      messageText.innerHTML = formatted;
      messageDiv.appendChild(messageText);

      if (sender === "bot") {
        const copyBtn = document.createElement("button");
        copyBtn.classList.add("copy-btn");
        copyBtn.textContent = "üìã Copy";
        copyBtn.onclick = () => {
          navigator.clipboard.writeText(text);
          copyBtn.textContent = "‚úÖ Copied!";
          setTimeout(() => (copyBtn.textContent = "üìã Copy"), 1500);
        };
        messageDiv.appendChild(copyBtn);
      }

      chatbox.appendChild(messageDiv);
      scrollToBottom();

      saveMessage({ text, sender });
    }

    function saveMessage(message) {
      let history = JSON.parse(sessionStorage.getItem(historyKey)) || [];
      history.push(message);
      sessionStorage.setItem(historyKey, JSON.stringify(history));
    }

    async function fetchHistoryFromBackend(passcode, append = false) {
      if (loadingHistory) return;
      loadingHistory = true;

      try {
        const res = await fetch(`${apiBase}/history?offset=${historyOffset}&limit=${historyLimit}`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ passcode })
        });

        if (!res.ok) {
          console.error("Failed to load history:", res.status);
          loadingHistory = false;
          return;
        }

        const data = await res.json();
        const messages = data.history || [];
        totalMessages = data.total || 0;

        const chatbox = document.getElementById("chatbox");

        if (append) {
          const oldScroll = chatbox.scrollHeight;
          const firstMsg = chatbox.firstChild;
          for (const msg of messages) {
            const div = document.createElement("div");
            div.classList.add("message", msg.sender);
            div.innerHTML = marked.parse(msg.text);
            chatbox.insertBefore(div, firstMsg);
          }
          const newScroll = chatbox.scrollHeight - oldScroll;
          chatbox.scrollTop = newScroll;
        } else {
          chatbox.innerHTML = "";
          for (const msg of messages) {
            const div = document.createElement("div");
            div.classList.add("message", msg.sender);
            div.innerHTML = marked.parse(msg.text);
            chatbox.appendChild(div);
          }
          scrollToBottom();
        }

        historyOffset += messages.length;
        loadingHistory = false;
      } catch (err) {
        console.error("Error loading chat history:", err);
        loadingHistory = false;
      }
    }

    function showTypingIndicator() {
      const chatbox = document.getElementById("chatbox");
      const div = document.createElement("div");
      div.classList.add("message", "bot");
      div.innerHTML = `
        <span class="typing"></span>
        <span class="typing"></span>
        <span class="typing"></span>
      `;
      chatbox.appendChild(div);
      scrollToBottom();
      return div;
    }

    function typeBotMessage(markdownText) {
      const chatbox = document.getElementById("chatbox");
      const messageDiv = document.createElement("div");
      messageDiv.classList.add("message", "bot");
      chatbox.appendChild(messageDiv);

      const formattedHTML = marked.parse(markdownText);
      const tempEl = document.createElement("div");
      tempEl.innerHTML = formattedHTML;
      const plainText = tempEl.textContent || tempEl.innerText || "";

      let i = 0;
      const speed = 1;
      const typingInterval = setInterval(() => {
        messageDiv.textContent = plainText.slice(0, i);
        scrollToBottom();
        i++;
        if (i > plainText.length) {
          clearInterval(typingInterval);
          messageDiv.innerHTML = formattedHTML;

          setTimeout(() => {
            const copyBtn = document.createElement("button");
            copyBtn.classList.add("copy-btn");
            copyBtn.textContent = "üìã Copy";
            copyBtn.onclick = () => {
              navigator.clipboard.writeText(plainText);
              copyBtn.textContent = "‚úÖ Copied!";
              setTimeout(() => (copyBtn.textContent = "üìã Copy"), 1500);
            };
            messageDiv.appendChild(copyBtn);
          }, 0);
        }
      }, speed);
    }

    document.addEventListener("keypress", function(e) {
      if (e.key === "Enter" && document.activeElement.id === "message-input") {
        sendMessage();
      }
    });

    document.getElementById("chatbox").addEventListener("scroll", async function() {
      const chatbox = this;
      const passcode = sessionStorage.getItem(passcodeKey);
      if (chatbox.scrollTop < 50 && historyOffset < totalMessages) {
        await fetchHistoryFromBackend(passcode, true);
      }
    });


    /***********************
     * Sample Questions: Click-to-Ask
     * - Randomize categories
     * - Randomize examples within each category
     * - Click fills input + sends immediately
     * - Show every login
     ************************/

    // 1) Êï∞ÊçÆÔºà‰∫îÁ±ªÔºåÊØèÁ±ª‰∏§ÈóÆÔºâ
    const SAMPLE_QUESTIONS = [
      {
        category: "Technology",
        examples: [
          "What might the Fourth Industrial Revolution look like?",
          "How can you integrate AI into your everyday study or work routines?"
        ]
      },
      {
        category: "Politics",
        examples: [
          "When making policies, how can governments better listen to the needs of different groups?",
          "How should a personal income tax system be designed to be fairer?"
        ]
      },
      {
        category: "Health",
        examples: [
          "Do you have any tips for boosting energy?",
          "Which lifestyle factors have the biggest impact on human lifespan?"
        ]
      },
      {
        category: "Sports",
        examples: [
          "How can you turn exercise into a long-term habit?",
          "What exercise frequency best promotes good health?"
        ]
      },
      {
        category: "Finance",
        examples: [
          "What should ordinary people know before they start investing?",
          "How can you manage risk in personal finance?"
        ]
      }
    ];

    // 2) ÁúüÈöèÊú∫Ê¥óÁâåÔºàFisher‚ÄìYatesÔºâ
    function shuffleArray(arr) {
      const a = [...arr];
      for (let i = a.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [a[i], a[j]] = [a[j], a[i]];
      }
      return a;
    }

    // 3) Â±ïÁ§∫ sample questionsÔºàÊØèÊ¨°ÁôªÂΩïÈÉΩË∞ÉÁî®Ôºâ
    function renderSampleQuestions() {
      const wrapper = document.getElementById("sample-questions");
      const container = document.getElementById("sq-container");
      if (!wrapper || !container) return;

      container.innerHTML = "";

      // ‚úÖ Á±ªÂà´ÈöèÊú∫
      const blocks = shuffleArray(SAMPLE_QUESTIONS);

      for (const block of blocks) {
        // ‚úÖ Á±ªÂà´ÂÜÖÁöÑ‰∏§‰∏™ÈóÆÈ¢ò‰πüÈöèÊú∫
        const examples = shuffleArray(block.examples);

        const blockDiv = document.createElement("div");
        blockDiv.className = "sq-block";

        const title = document.createElement("div");
        title.className = "sq-category";
        title.textContent = block.category;
        blockDiv.appendChild(title);

        for (const q of examples) {
          // ÊØèÊù°Á§∫‰æãÂ∞±ÊòØ‰∏ÄË°åÂèØÁÇπÂáªÂå∫Âüü
          const row = document.createElement("div");
          row.className = "sq-item";
          row.style.cursor = "pointer";
          row.style.borderRadius = "10px";
          row.style.padding = "8px 10px";

          row.onmouseenter = () => (row.style.background = "#f1f1f4");
          row.onmouseleave = () => (row.style.background = "transparent");

          const text = document.createElement("div");
          text.className = "sq-text";
          text.textContent = q;

          // ‚úÖ ÁÇπÂáªÂç≥ÈóÆÔºöÂ°´ÂÖ•ËæìÂÖ•Ê°ÜÂπ∂Áõ¥Êé•ÂèëÈÄÅ
          row.onclick = () => {
            const input = document.getElementById("message-input");
            if (!input) return;

            input.value = q;
            input.focus();

            // Áõ¥Êé•ÂèëÈÄÅÔºàÁî®‰Ω†Â∑≤ÊúâÁöÑ sendMessage()Ôºâ
            sendMessage();

            // Êõ¥ÂÉè ChatGPTÔºöÂèëÈÄÅÂêéÈöêËóèÁ§∫‰æã
            // hideSampleQuestions();
          };

          row.appendChild(text);
          blockDiv.appendChild(row);
        }

        container.appendChild(blockDiv);
      }

      wrapper.style.display = "block";

      const banner = document.getElementById("welcome-banner");
      if (banner) banner.style.display = "block";
    }

    // 4) ÈöêËóè sample questions
    function hideSampleQuestions() {
      const wrapper = document.getElementById("sample-questions");
      if (wrapper) wrapper.style.display = "none";

      const banner = document.getElementById("welcome-banner");
      if (banner) banner.style.display = "none";
    }

    // 5) Hook Âà∞ÁôªÂΩïÊàêÂäüÔºà‰∏çÊîπ‰Ω†ÂéüÈÄªËæëÔºåÂè™Âú®ÊàêÂäüÂêé‚ÄúË°•‰∏Ä‰∏™Ë∞ÉÁî®‚ÄùÔºâ
    function showSamplesAfterLogin() {
      // ÊØèÊ¨°ÁôªÂΩïÈÉΩÊòæÁ§∫Ôºà‰∏çÁºìÂ≠òÔºâ
      renderSampleQuestions();
    }

    // ‚úÖ Ëá™Âä®Êää sample questions Êé•Âà∞‰Ω†Áé∞ÊúâÁöÑ login / auto-login ÊµÅÁ®ãÔºö
    // - Â¶ÇÊûú‰Ω†Â∑≤ÁªèÊúâ window.onloadÔºå‰∏ãÈù¢‰∏ç‰ºöË¶ÜÁõñÔºåËÄåÊòØ‚ÄúËøΩÂä†ÁõëÂê¨‚Äù
    window.addEventListener("load", () => {
      // Âè™Ë¶ÅËÅäÂ§©ÂÆπÂô®ÊòæÁ§∫‰∫ÜÔºåÂ∞±Â±ïÁ§∫ sample questions
      const chat = document.getElementById("chat-container");
      if (chat && getComputedStyle(chat).display !== "none") {
        showSamplesAfterLogin();
      }
    });

    // ‚úÖ ‰Ω†ÁôªÂΩïÊàêÂäüÂêé‰ºöÊää chat-container display ÊîπÊàê flex
    // Êàë‰ª¨Áî®‰∏Ä‰∏™Â∞èÂ∞èÁöÑËßÇÂØüÂô®Ôºö‰∏ÄÊó¶ chat-container Ë¢´ÊòæÁ§∫ÔºåÂ∞±Ëá™Âä® render
    (function observeChatContainer() {
      const chat = document.getElementById("chat-container");
      if (!chat) return;

      const obs = new MutationObserver(() => {
        if (getComputedStyle(chat).display !== "none") {
          showSamplesAfterLogin();
        }
      });

      obs.observe(chat, { attributes: true, attributeFilter: ["style"] });
    })();


    //È°µÈù¢ÊªöÂä®ÈóÆÈ¢ò
    function scrollToBottom() {
      const chatMain = document.getElementById("chat-main");
      if (chatMain) {
        chatMain.scrollTo({
          top: chatMain.scrollHeight,
          behavior: "smooth"
        });
      }
    }

  </script>
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
</body>
</html>